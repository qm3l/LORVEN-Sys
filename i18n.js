// i18n.js
// --------- ترجمة كاملة ----------
const i18n = {
    ar: {
        home: 'الرئيسية',
        products: 'المنتجات',
        invoices: 'الفواتير',
        reports: 'التقارير',
        settings: 'الإعدادات',
        dashboard: 'الرئيسية',
        history: 'سجل الفواتير',
        sendInvoice: 'إرسال الفاتورة',
        cancel: 'إلغاء',
        send: 'إرسال',
        newProduct: 'منتج جديد',
        productName: 'اسم المنتج',
        barcode: 'الباركود',
        cost: 'التكلفة',
        aiAssistantTitle: 'مساعد لورفين الذكي',
        aiWelcomeMessage: 'مرحباً! أنا مساعدك الذكي. كيف يمكنني مساعدتك اليوم؟',
        aiInputPlaceholder: 'اكتب سؤالك هنا...',
        fileAttached: 'ملف مرفوع',
        price: 'السعر',
        stock: 'المخزون',
        category: 'الفئة',
        saveProduct: 'حفظ المنتج',
        editProduct: 'تعديل المنتج',
        update: 'تحديث',
        deleteProduct: 'حذف المنتج',
        invoiceDetails: 'تفاصيل الفاتورة',
        searchInvoice: 'بحث متقدم',
        invoiceNumber: 'رقم الفاتورة',
        customerName: 'اسم العميل',
        search: 'بحث',
        monthlyInvoice: 'فواتير شهرية',
        selectCustomer: 'اختر العميل',
        month: 'الشهر',
        generate: 'إنشاء',
        importData: 'استيراد ملف',
        importHint: 'يمكنك رفع ملف CSV أو Excel يحتوي على المنتجات أو الفواتير.',
        importProducts: 'منتجات',
        importInvoices: 'فواتير',
        chooseFile: 'اختيار',
        import: 'استيراد',
        customerPhone: 'رقم العميل',
        todaySales: 'مبيعات اليوم',
        netProfit: 'صافي الربح',
        todayOrders: 'طلبات اليوم',
        newCustomers: 'عملاء جدد',
        quickActions: 'إجراءات سريعة',
        searchBtn: 'بحث متقدم',
        monthlyBtn: 'فواتير شهرية',
        invoice: 'فاتورة',
        importAction: 'استيراد',
        recentInvoices: 'آخر الفواتير',
        noInvoices: 'لا توجد فواتير بعد',
        customer: 'عميلة',
        noProducts: 'لا توجد منتجات',
        stockLabel: 'مخزون',
        edit: 'تعديل',
        addedToCart: 'أضيف للمشتريات',
        deleted: 'تم الحذف',
        productNotFound: 'المنتج غير موجود. هل تريد إضافته الآن؟',
        cameraDenied: 'لا يمكن الوصول إلى الكاميرا. تأكد من منح الإذن.',
        customerInfo: 'معلومات العميل',
        name: 'الاسم',
        phone: 'رقم الجوال',
        invoiceSummary: 'ملخص الفاتورة',
        subtotal: 'إجمالي المنتجات',
        delivery: 'التوصيل',
        total: 'الإجمالي',
        whatsapp: 'واتساب',
        save: 'حفظ',
        print: 'طباعة',
        invoiceNo: 'رقم الفاتورة',
        emptyInvoice: 'الفاتورة فارغة',
        invoiceSaved: 'تم حفظ الفاتورة',
        enterPhone: 'أدخلي رقم الجوال',
        whatsappOpened: 'تم فتح واتساب والفاتورة محفوظة',
        fillFields: 'الرجاء ملء الحقول الأساسية',
        productAdded: 'تمت إضافة المنتج',
        productUpdated: 'تم تحديث المنتج',
        confirmDeleteProduct: 'هل أنت متأكدة من حذف هذا المنتج؟',
        productDeleted: 'تم حذف المنتج',
        confirmDeleteInvoice: 'هل أنت متأكدة من حذف هذه الفاتورة؟',
        invoiceDeleted: 'تم حذف الفاتورة',
        invoiceNotFound: 'الفاتورة غير موجودة',
        noCustomer: 'غير مسجل',
        close: 'إغلاق',
        deleteInvoice: 'حذف الفاتورة',
        noResults: 'لا توجد نتائج',
        selectCustomerMonth: 'اختر العميل والشهر',
        noMonthlyInvoices: 'لا توجد فواتير لهذا الشهر',
        salesReports: 'تقارير المبيعات',
        detailedReport: 'تقرير مفصل',
        totalSales: 'إجمالي المبيعات',
        totalInvoices: 'عدد الفواتير',
        averageOrder: 'متوسط قيمة الفاتورة',
        invoiceHistory: 'سجل الفواتير',
        noSavedInvoices: 'لا توجد فواتير محفوظة',
        settingsTitle: 'الإعدادات',
        customizeHint: 'خصّص التطبيق حسب رغبتك',
        general: 'الإعدادات العامة',
        darkModeLabel: 'الوضع الليلي، اللغة',
        countryCodeLabel: 'رمز الدولة للواتساب',
        autoAdd: 'إضافة تلقائية',
        asIs: 'بدون إضافة',
        messageTemplate: 'قالب الرسالة',
        editWhatsApp: 'تعديل نص واتساب',
        backup: 'النسخ الاحتياطي',
        exportImport: 'تصدير واستيراد البيانات',
        adsSystem: 'نظام الإعلانات',
        sendOffers: 'إرسال عروض للعملاء',
        customize: 'تخصيص التطبيق',
        storeLogo: 'الشعار، اسم المتجر',
        security: 'الأمان والخصوصية',
        appLock: 'قفل التطبيق، PIN',
        generalSettings: 'الإعدادات العامة',
        darkMode: 'الوضع الليلي',
        language: 'اللغة',
        aiSettingsTitle: 'إعدادات الذكاء الاصطناعي (Gemini)',
        aiApiKeyDesc: 'أدخل مفتاح API الخاص بـ Google Gemini. يمكنك الحصول عليه من',
        geminiApiKey: 'مفتاح Gemini API',
        model: 'النموذج',
        recommended: 'مُوصى به',
        latest: 'أحدث إصدار',
        temperature: 'درجة الحرارة (الإبداع)',
        save: 'حفظ',
        auto: 'تلقائي',
        light: 'فاتح',
        dark: 'داكن',
        saveGeneral: 'حفظ',
        countryCode: 'رمز الدولة',
        countryCodeSelect: 'اختر رمز الدولة',
        customCode: 'رمز مخصص',
        behavior: 'عند الإرسال',
        addAutomatically: 'إضافة الرمز تلقائياً',
        useAsIs: 'استخدم الرقم كما هو',
        saveCountryCode: 'حفظ',
        template: 'قالب الرسالة',
        saveTemplate: 'حفظ القالب',
        aiSettings: 'إعدادات الذكاء',
        aiApiKey: 'تعيين مفتاح Gemini',
        exportBackup: 'تصدير نسخة',
        importBackup: 'استيراد نسخة',
        adMessage: 'نص الإعلان',
        sendAds: 'إرسال للجميع',
        storeName: 'اسم المتجر',
        logoUrl: 'رابط الشعار (اختياري)',
        saveCustomization: 'حفظ',
        appLockSelect: 'تفعيل قفل التطبيق',
        pinCode: 'أدخل رمز PIN',
        saveSecurity: 'حفظ',
        off: 'غير مفعل',
        enterSearchCriteria: ' ادخل رقم الفاتورة أو اسم العميل',
        clearCache: 'مسح ملفات التخزين المؤقتة',
        date: 'التاريخ',
        all: 'الكل',
        next: 'التالي',
        prev: 'السابق',
        selectAll: "تحديد الكل",
        deselectAll: "إلغاء الكل",
        delete: "حذف",
        forInvoice: "للفاتورة",
        complete: "إنهاء",
        page: 'الصفحة',
        privacyPolicy: 'سياسة الخصوصية',
        privacyPolicyDesc: 'عرض سياسة الخصوصية',
        termsOfService: 'شروط الاشتراك',
        termsDesc: 'عرض شروط الخدمة',
        productNamePlaceholder: 'مثال: سيروم فيتامين سي',
        barcodePlaceholder: 'سيتم إنشاؤه تلقائياً',
        costPlaceholder: '0.00',
        pricePlaceholder: '0.00',
        stockPlaceholder: '0',
        categories: ['عناية بالبشرة', 'مكياج', 'عناية بالشعر', 'عطور', 'منتجات طبيعية'],
    },
    en: {
        home: 'Home',
        products: 'Products',
        invoices: 'Invoices',
        reports: 'Reports',
        settings: 'Settings',
        all: 'All',
        dashboard: 'Dashboard',
        history: 'History',
        sendInvoice: 'Send Invoice',
        cancel: 'Cancel',
        send: 'Send',
        newProduct: 'New Product',
        productName: 'Product Name',
        barcode: 'Barcode',
        cost: 'Cost',
        price: 'Price',
        stock: 'Stock',
        category: 'Category',
        saveProduct: 'Save Product',
        editProduct: 'Edit Product',
        update: 'Update',
        deleteProduct: 'Delete Product',
        invoiceDetails: 'Invoice Details',
        searchInvoice: 'Advanced Search',
        invoiceNumber: 'Invoice Number',
        customerName: 'Customer Name',
        aiSettings: 'AI Settings',
        aiApiKey: 'Set Gemini API Key',
        aiAssistantTitle: 'LORVEN AI Assistant',
        aiWelcomeMessage: 'Hello! I am your smart assistant. How can I help you today?',
        aiInputPlaceholder: 'Type your question here...',
        fileAttached: 'File attached',
        search: 'Search',
        monthlyInvoice: 'Monthly Invoice',
        selectCustomer: 'Select Customer',
        month: 'Month',
        generate: 'Generate',
        importData: 'Import File',
        importHint: 'Upload CSV or Excel file containing products or invoices.',
        importProducts: 'Products',
        importInvoices: 'Invoices',
        chooseFile: 'Choose',
        import: 'Import',
        customerPhone: 'Customer Phone',
        todaySales: 'Today Sales',
        netProfit: 'Net Profit',
        todayOrders: 'Today Orders',
        newCustomers: 'New Customers',
        quickActions: 'Quick Actions',
        searchBtn: 'Search',
        monthlyBtn: 'Monthly',
        aiSettingsTitle: 'AI Settings (Gemini)',
        aiApiKeyDesc: 'Enter your Google Gemini API key. You can get it from',
        geminiApiKey: 'Gemini API Key',
        model: 'Model',
        recommended: 'recommended',
        latest: 'latest',
        temperature: 'Temperature (creativity)',
        save: 'Save',
        invoice: 'Invoice',
        importAction: 'Import',
        recentInvoices: 'Recent Invoices',
        noInvoices: 'No invoices yet',
        customer: 'Customer',
        noProducts: 'No products',
        stockLabel: 'Stock',
        edit: 'Edit',
        addedToCart: 'Added to cart',
        deleted: 'Deleted',
        productNotFound: 'Product not found. Add now?',
        cameraDenied: 'Cannot access camera.',
        customerInfo: 'Customer Info',
        name: 'Name',
        phone: 'Phone',
        invoiceSummary: 'Invoice Summary',
        subtotal: 'Subtotal',
        delivery: 'Delivery',
        total: 'Total',
        whatsapp: 'WhatsApp',
        save: 'Save',
        print: 'Print',
        invoiceNo: 'Invoice No.',
        emptyInvoice: 'Invoice is empty',
        invoiceSaved: 'Invoice saved',
        enterPhone: 'Enter phone number',
        whatsappOpened: 'WhatsApp opened, invoice saved',
        fillFields: 'Please fill required fields',
        productAdded: 'Product added',
        productUpdated: 'Product updated',
        confirmDeleteProduct: 'Delete this product?',
        productDeleted: 'Product deleted',
        confirmDeleteInvoice: 'Delete this invoice?',
        invoiceDeleted: 'Invoice deleted',
        invoiceNotFound: 'Invoice not found',
        noCustomer: 'Not registered',
        close: 'Close',
        deleteInvoice: 'Delete Invoice',
        noResults: 'No results',
        selectCustomerMonth: 'Select customer and month',
        noMonthlyInvoices: 'No invoices for this month',
        salesReports: 'Sales Reports',
        detailedReport: 'Detailed Report',
        totalSales: 'Total Sales',
        totalInvoices: 'Total Invoices',
        averageOrder: 'Average Order',
        invoiceHistory: 'Invoice History',
        noSavedInvoices: 'No saved invoices',
        settingsTitle: 'Settings',
        customizeHint: 'Customize the app as you like',
        general: 'General',
        darkModeLabel: 'Dark mode, Language',
        countryCodeLabel: 'WhatsApp Country Code',
        autoAdd: 'Auto add',
        asIs: 'As is',
        messageTemplate: 'Message Template',
        editWhatsApp: 'Edit WhatsApp text',
        backup: 'Backup',
        exportImport: 'Export/Import data',
        adsSystem: 'Ads System',
        sendOffers: 'Send offers to customers',
        customize: 'Customize',
        storeLogo: 'Store name, Logo',
        security: 'Security',
        appLock: 'App lock, PIN',
        generalSettings: 'General Settings',
        darkMode: 'Dark mode',
        language: 'Language',
        auto: 'Auto',
        light: 'Light',
        dark: 'Dark',
        saveGeneral: 'Save',
        countryCode: 'Country Code',
        countryCodeSelect: 'Select country code',
        customCode: 'Custom code',
        behavior: 'When sending',
        addAutomatically: 'Add code automatically',
        useAsIs: 'Use number as is',
        saveCountryCode: 'Save',
        template: 'Message Template',
        saveTemplate: 'Save Template',
        exportBackup: 'Export Backup',
        importBackup: 'Import Backup',
        adMessage: 'Ad message',
        sendAds: 'Send to all',
        storeName: 'Store name',
        logoUrl: 'Logo URL (optional)',
        saveCustomization: 'Save',
        appLockSelect: 'App lock',
        pinCode: 'Enter PIN',
        saveSecurity: 'Save',
        off: 'Off',
        enterSearchCriteria: 'Enter invoice number or customer name',
        date: 'Date',
        all: 'All',
        next: 'Next',
        prev: 'Previous',
selectAll: "Select All",
        deselectAll: "Deselect All",
        delete: "Delete",
        forInvoice: "For Invoice",
        complete: "Complete",
        page: 'Page',
        privacyPolicy: 'Privacy Policy',
        privacyPolicyDesc: 'View privacy policy',
        termsOfService: 'Terms of Service',
        termsDesc: 'View terms of service',
        productNamePlaceholder: 'e.g., Vitamin C Serum',
        barcodePlaceholder: 'Will be auto-generated',
        costPlaceholder: '0.00',
        pricePlaceholder: '0.00',
        stockPlaceholder: '0',
        categories: ['Skincare', 'Makeup', 'Hair Care', 'Perfumes', 'Natural Products'],
    categoryTranslations: {
        'شامبو': 'Shampoo',
        'بلسم': 'Conditioner',
        'زيت': 'Oil',
        'كريم': 'Cream',
        'غسول': 'Wash',
        'لوشن': 'Lotion',
        'صابون': 'Soap',
        'عناية بالشعر': 'Hair Care',
        'واقي شعر': 'Heat Protectant',
        'سيروم': 'Serum',
        'ماسك': 'Mask',
        'أطفال': 'Baby',
        'واقي شمس': 'Sunscreen',
        'عناية بالبشرة': 'Skincare',
        'مقشر': 'Scrub',
        'مكياج': 'Makeup',
        'عطور': 'Perfumes',
        'منتجات عامة': 'General',
        'معطر': 'Freshener',
    },
        clearCache: 'Clear Cache'
    }
};

// ---------- تطبيق الإعدادات ----------
function applySettings() {
    // تطبيق الوضع الليلي
    if (settings.darkMode === 'dark') {
        document.body.classList.add('dark-mode');
    } else if (settings.darkMode === 'light') {
        document.body.classList.remove('dark-mode');
    } else if (settings.darkMode === 'auto') {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    }

    // تطبيق اللغة والاتجاه
    const lang = settings.language || 'ar';
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    
    // إضافة/إزالة كلاس للإنجليزية لتخصيصات CSS إضافية
    if (lang === 'en') {
        document.body.classList.add('english-mode');
    } else {
        document.body.classList.remove('english-mode');
    }

    // ترجمة النصوص
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (i18n[lang] && i18n[lang][key]) {
            el.textContent = i18n[lang][key];
        }
    });

    // ترجمة الـ placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        if (i18n[lang] && i18n[lang][key]) {
            el.placeholder = i18n[lang][key];
        }
    });

    // تحديث عنوان الصفحة
    document.getElementById('dynamicTitle').innerText = settings.storeName + ' · ' + (lang === 'ar' ? 'النظام المحاسبي' : 'Accounting System');

    // إعادة رسم الرسوم البيانية إذا كنا في صفحة التقارير
    if (currentPage === 'reports') {
        setTimeout(() => {
            if (typeof generateSalesChart === 'function' && typeof generateCategoryChart === 'function') {
                generateSalesChart();
                generateCategoryChart();
            } else {
                console.warn('Chart functions not ready yet');
            }
        }, 200);
    }
}